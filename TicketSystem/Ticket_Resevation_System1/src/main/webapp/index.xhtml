<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<h:outputStylesheet library="css" name="style.css"/>
<title>Insert title here</title>
<script>
function reservationConfirmation(linkId){
	document.getElementById(linkId).click();
	var confirmed = window.confirm("Are you sure you want to reserve this ticket?");
	if(confirmed){
		document.getElementById("ajaxForm:restartTicket").click();
		return false;
	}
	return true;
}
</script>
</h:head>
<h:body>
<div id="container">
<div id="button_container">
<h:form id="ajaxForm">
<h:commandButton id="restartTicket" type="submit" action="#{reservations.requestedTicket(-1)}" style="display:none;"/>
<!-- end of ajax calls -->
</h:form>
<h:form id="mainForm">
<div>
<h:commandButton value="CLEAR" action="#{reservations.clear()}" styleClass="clear_button"/>
<h:inputText id="username_input" value="#{reservations.username}" />
</div>

<!-- ajax calls - temporary reserve ticket prior to confirmation -->
<ui:repeat id="ajaxRepeater" value="#{reservations.tickets.entrySet().toArray()}"  var="counter">
<h:commandButton id="ajaxButton" style="display:none;">
<f:ajax execute="@form" listener="#{reservations.reserve(counter.key)}"/>
</h:commandButton>
</ui:repeat>

<!-- ticket buttons -->
<div style="overflow:hidden;">
<ui:repeat value="#{reservations.tickets.entrySet().toArray()}"  var="counter">
<h:commandLink onclick="return reservationConfirmation('mainForm:ajaxRepeater:#{counter.key}:ajaxButton')" action="#{reservations.declineReservation(counter.key)}" 
styleClass="button #{reservations.reservationCheck(counter.key)}" >reserve </h:commandLink>
</ui:repeat>
</div>

<div id="message_container">
<h:outputText  value="Enter your name first." rendered="#{empty reservations.username}"/>
<h:outputText  value="This place is already reserved." rendered="#{reservations.reserved}"/>
</div>

</h:form>

</div>
</div>
</h:body>
</html>